worker_processes  1;
events {}

http {
    lua_package_path "/etc/nginx/?.lua;;";
    lua_package_cpath "/usr/local/openresty/lualib/?.so;;";

    # Upstream to our FastAPI container
    upstream api {
        server bot-api:8000;
    }

    server {
        listen 80;
        server_name localhost;

        # Proxy all /api/* requests to FastAPI
        location /api/ {
            # Strip the /api prefix so /api/login â†’ /login
            rewrite ^/api/(.*)$ /$1 break;

            # Optional: your Lua hook for extracting additional fields
            access_by_lua_file /etc/nginx/extract.lua;

            proxy_pass         http://api;
            proxy_http_version 1.1;
            proxy_set_header   Host            $host;
            proxy_set_header   X-Real-IP       $remote_addr;
            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        }

        # (Optional) serve static React build here if you want to host it from Nginx
        # location / {
        #     root   /usr/share/nginx/html;
        #     try_files $uri $uri/ /index.html;
        # }
    }
}
